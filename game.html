
<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<head>

    <title>Little Battle</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="style/main.css" rel="stylesheet">
    <link href="style/repo.css" rel="stylesheet">
    <link href="style/game.css" rel="stylesheet">

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/ace/1.2.6/ace.js"></script>
    <script src="lib/jquery.scrollex.min.js"></script>
    <script src="lib/jquery.scrolly.min.js"></script>
    <script src="lib/skel.min.js"></script>
    <script src="lib/util.js"></script>
    <script src="lib/main.js"></script>
    <script src="lib/quisus.js"></script>
    <script src="core.js"></script>
    <script src="renderer.js"></script>
        
</head>

  <body>

        <!-- Page Wrapper -->
            <div id="page-wrapper">

                <!-- Header -->
                    <header id="header">
                       <h1><a href="index.html">Little Battle</a></h1>
                        <nav id="nav">
                            <ul>
                                <li class="special">
                                    <a href="#menu" class="menuToggle"><span>MENU</span></a>
                                    <div id="menu">
                                        <ul>
                                            <li><a href="index.html">HOME</a></li>
                                            <li><a href="login.html">SIGN IN</a></li>
                                            <li><a href="signup.html">SIGN UP</a></li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </nav>
                    </header>
                </div>
                <div class="left_body">
                        <div id="repo">
                                        <ul id="repo_list">
                                            <li><span>ID</span><span>K/D</span><span>RATE</span></li>

                                        </ul>
                                    </div>                
                        <ul>
                            <li id="controlBtn" class="button info fit">START</li>
                            <li id="clearBtn" class="button info fit">CLEAR</li>
                            <a id="repoBtn" href="#repo" class="button info fit">ADD</a>
                        </ul>
                        <div id="editor">
                            {
                                    //每帧开始时无条件触发
                                onEvent : function() {
                                    this.fire();
                                },

                                onHitWall : function() {

                                },

                                onHitByBullet : function() {

                                }
                            }
                        </div>
                            
                        
               
                </div>
                <div class="right_body">
                    <canvas id="map"></canvas>
                </div>
            </div>
             

        <script>
            if (!localStorage.curUser)
                window.location.href = "login.html";

            var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode("ace/mode/javascript");
        editor.setFontSize(14);
        editor.getSession().setOptions({
            tabSize: 2,
            useSoftTabs: true
        });
        editor.getSession().on('change', function(e) {
            window.current_code = editor.getValue();
            
        });
        </script>

        <script>
        var enviroment = {
                map: document.getElementById('map'),
                ctx: map.getContext('2d')
        }
        core = new Q.core(enviroment,{width:600,height:600},{width:20,height:20});
        </script>

    <script>
        var socket = io.connect();
        $("#repoBtn").on('click', ()=>{
            let list = document.getElementById('repo_list');
            list.innerHTML = "<li><span>ID</span><span>K/D</span><span>RATE</span></li>";
            if (localStorage.curUser && localStorage.curUser !== '') {
                socket.emit('get_repo');
            }
        });

        socket.on('recv_repo',(results)=>{
            let list = document.getElementById('repo_list');
            for (let i=0; i<results.length; i++)
                if (results[i]) {
                    list.innerHTML = list.innerHTML + "<li><span>" +
                        results[i].id + "</span><span>" +
                        results[i].num_kill + "/" +
                        results[i].num_death + "</span><span>RATE</span><span class='join'>Join</span></li>";
                }
        });
    </script>
    <script>
        $("#clearBtn").on('click', ()=>{
            core = new Q.core(enviroment,{width:600,height:600},{width:20,height:20});
            core.add_player(localStorage.curUser, window.current_code);
        });
        var controlBtn = document.getElementById("controlBtn");
        $("#controlBtn").on('click', ()=>{
            if (core.running) {
                core.running = false;
                controlBtn.innerHTML = "START";
            }
            else {
                core.running = true;
                controlBtn.innerHTML = "PAUSE";
            }
        });
    </script>

</body>
</html>